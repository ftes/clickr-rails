#!/bin/sh
# Usage: setup-environment-variables <rails-master-key>
# TODO Use .env.git as source of truth (that can be committed)

set -ex

echo "CLICKR_POST_ENDPOINT=http://web/clicks" > .env
echo "RAILS_MASTER_KEY=$1" >> .env
echo "RFID_KEYBOARD_READER_USB_IDS=16c0:27db" >> .env
echo "RFID_KEYBOARD_READER_DEBOUNCE_SECONDS=3" >> .env
echo "ZSTACK_ZIGBEE_PERMIT_JOIN=true" >> .env
echo "ZSTACK_ZIGBEE_DEVICE=/dev/ttyACM0" >> .env

yarn --cwd build/balena-cli balena env add --application clickr CLICKR_POST_ENDPOINT "http://web/clicks"
yarn --cwd build/balena-cli balena env add --application clickr RAILS_MASTER_KEY "$1"
yarn --cwd build/balena-cli balena env add --application clickr RFID_KEYBOARD_READER_USB_IDS "16c0:27db"
yarn --cwd build/balena-cli balena env add --application clickr RFID_KEYBOARD_READER_DEBOUNCE_SECONDS "3"
yarn --cwd build/balena-cli balena env add --application clickr ZSTACK_ZIGBEE_PERMIT_JOIN "true"
yarn --cwd build/balena-cli balena env add --application clickr ZSTACK_ZIGBEE_DEVICE "/dev/ttyACM0"
